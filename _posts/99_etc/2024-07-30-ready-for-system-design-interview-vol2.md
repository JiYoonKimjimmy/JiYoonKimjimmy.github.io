---
layout: post
title : Ready for System Design Interview Vol.2
date  : 2024-07-30
image : ready-for-system-design.png
tags  : interview back-end system-design systemdesign
---

시스템 디자인 인터뷰를 진행하면서 준비가 필요한 항목에 대해서 좀 더 정리해보고자 한다.

대략적인 솔루션은 알고 있었겠지만, 상세한 설계에 대한 방법에 대한 준비와 정리가 필요하다.

1. 요청 트래픽 제한되는 외부 서비스 연동 시스템 설계
2. 분리된 다른 시스템 간 요청 거래 대사 시스템 설계

---

## 1. 요청 트래픽 제한되는 외부 서비스 연동 시스템 설계

### Requirments

결제 서비스 구현을 위해 내부 결제 시스템을 통해 외부 결제 서비스 연동이 필요한 상황이다.
외부 결제 서비스는 최대 `TPS 500` 트래픽만 허용한다는 제약 조건이 있을 떄, 
폭발적인 트래픽 증가로 `TPS 500` 을 초과하더라도 외부 결제 시스템까지 정상 연동하여 동작할 수 있는 시스템을 설계해보는 것이 목표이다.

- 결제 서비스를 위해 내부 결제 시스템을 통해 외부 결제 서비스 연동 필요
- 외부 결제 서비스 최대 `TPS 500` 트래픽 허용
- `TPS 500` 이상 초과 트래픽은 지연 처리

---

### Solutions

#### Rate Limiting

**`Rate Limiter` 처리율 제한기**를 통한다면 지정한 트래픽만큼 처리하고, 그 이상의 트래픽을 거부할 수 있는 시스템 구축이 가능하다.

처리율 제한기 구현을 위해서는 `Token Bucket 알고리즘`, `Leaky Bucket 알고리즘`, `Sliding Window 알고리즘` 등 여러 알고리즘 적용하여 처리할 수 있다.

하지만, 처리율 제한기의 한계점은 초과 트래픽에 대한 지연 처리가 힘들다는 점이다.
초과 요청되는 트래픽을 `429 Too Many Requests` 상태 거부 응답 처리가 되기 때문이다.

#### Queueing

처리율 제한기의 한계점을 해결하기 위해서 비동기적으로 요청 트래픽을 제어할 수 있는 `Queue` 자료구조를 가진 시스템을 적용해보면 좋을 것 같다.

`Queue` 시스템을 도입한다면, 아래와 같은 다양한 장점을 가져올 수 있다.

- 비동기 처리
- 부하 분산 처리
- `FIFO` 처리
- 확장성, 내구성 등

`Queue` 지원 `Message Broker` 종류는 다양하고, 대표적으로는 다음과 같다.

- `RabbitMQ`
  - 다양한 메시징 프로토콜 지원
  - `AMQP` 프로토콜 사용
  - 중소규모 처리 성능 적합
  - **메모리 저장 방식**으로 별도 메시지 보존 없이 소비 후 삭제
  - `Queue` 단위 메시지 순서 보장
  - 까다로운 클러스터링 구성
- `Apacche Kafka`
  - 대규모 데이터 스트림 실시간 분산 처리 지원
  - `TCP` 기반 자체 프로토콜 사용
  - 높은 데이터 처리량 보장
  - **디스크 로그 저장 방식**으로 설정 기간 동안 메시지 저장 유지
  - 파티션 단위 메시지 순서 보장
  - 비교적 편리한 클러스터링 구성
- `Amazon SQS`
  - 클라우드 완전 관리형 서비스
  - 간단한 구현과 높은 가용성 보장

---

## 2. 분리된 다른 시스템 간 요청 거래 대사 시스템 설계

### Requirments

결제 서비스를 통해 결제 완료된 거래에 대해서는 정산 처리가 필요하다.
결제 완료 거래에 대한 정산 처리를 위해 정산 서비스를 별도로 구현하였을 떄,
결제 서비스와 정산 서비스 간의 요청 거래 대사 시스템 설계해보는 것이 목표이다.

- 결제 완료 거래를 결제 서비스에서 정산 서비스로 요청 거래 대사 필요

---

#### 출처


---
