I"¤%<h1 id="spring-boot--social-loginkakao">Spring Boot + Social Login(Kakao)</h1>
<h2 id="oauth-20">OAuth 2.0</h2>
<p>íƒ€ì‚¬ì˜ API ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ ê¶Œí•œ íšë“ ë° ì¸ì¦ì„ ìœ„í•œ Open Standard Protocol</p>

<h2 id="oauth-êµ¬ì¡°">OAuth êµ¬ì¡°</h2>
<h3 id="oauth-êµ¬ì„±">OAuth êµ¬ì„±</h3>
<ul>
  <li>Client : ì‚¬ìš©ì</li>
  <li>Resource Owner : API DB ì‚¬ìš©ì</li>
  <li>Resource Server : API ì„œë²„</li>
  <li>AUthorization Server : OAuth ì¸ì¦ ì„œë²„</li>
</ul>

<h3 id="oauth-flow">OAuth Flow</h3>
<p><img src="/assets/25238637583547EC0A.png" alt="25238637583547EC0A" />
<br />
(A) Client ê°€ Social Login ìš”ì²­<br />
(B) Resource Owner ëŠ” Social Login í•  ìˆ˜ ìˆê²Œ í™”ë©´ ì´ë™<br />
(C) Client ëŠ” Social Login ì™„ë£Œ<br />
(D) ë¡œê·¸ì¸ì´ ì„±ê³µí•˜ë©´ AUthorization Server ëŠ” Client ì—ê²Œ Access Token ë°œê¸‰<br />
(E) Client ëŠ” ë°œê¸‰ë°›ì€ Token ìœ¼ë¡œ Resource Server ì—ê²Œ Resource ë¥¼ ìš”ì²­<br />
(D) Resource Server ëŠ” Token ìœ íš¨í•œì§€ ê²€ì¦í•˜ê³  ì‘ë‹µ ì²˜ë¦¬<br /></p>

<hr />

<h2 id="kakao-soical-login">Kakao Soical Login</h2>
<h3 id="token-ì¢…ë¥˜">Token ì¢…ë¥˜</h3>
<ul>
  <li>Access Token : API í˜¸ì¶œ ê¶Œí•œ ì¸ì¦ìš© Token</li>
  <li>Refresh Token : Access Token ê°±ì‹ ìš© Token</li>
</ul>

<h3 id="kakao-developer-ê´€ë¦¬">Kakao Developer ê´€ë¦¬</h3>
<ul>
  <li><a href="https://developers.kakao.com/">Kakao Developer ì‚¬ì´íŠ¸</a></li>
  <li><a href="https://velog.io/@magnoliarfsit/%EA%B7%B8%EB%A3%B9%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%ED%94%84%EB%A6%BD-%EB%93%A4%EC%96%B4%EA%B0%80%EA%B8%B0-%EC%A0%84%EC%97%90-1">ê³„ì • ìƒì„± ë° ë“±ë¡ ë°©ë²•(velog blog)</a></li>
</ul>

<h3 id="êµ¬í˜„-ìˆœì„œ">êµ¬í˜„ ìˆœì„œ</h3>
<p><a href="https://developers.kakao.com/docs/latest/ko/kakaologin/common">Kakao Login êµ¬í˜„ ê³µí†µ ê°€ì´ë“œ</a></p>

<p><strong>RestTemplate Bean ë“±ë¡</strong></p>
<ul>
  <li>Main Application Class ì— RestTemplate Class Bean ë“±ë¡
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">RestTemplate</span> <span class="nf">getRestTemplate</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">RestTemplate</span><span class="o">();</span> <span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>GSON dependency ì¶”ê°€</strong></p>
<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">implementation</span> <span class="s1">'com.google.code.gson:gson'</span>
</code></pre></div></div>

<p><strong>Social Login ê´€ë ¨ ì„¤ì • ì¶”ê°€</strong></p>
<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.social.kakao.client_id</span><span class="p">=</span><span class="s">[ì•±ìƒì„±ì‹œ ë°›ì€ REST API Key]</span>
<span class="py">spring.social.kakao.redirect</span><span class="p">=</span><span class="s">/social/login/kakao</span>
<span class="py">spring.social.kakao.url.login</span><span class="p">=</span><span class="s">https://kauth.kakao.com/oauth/authorize</span>
<span class="py">spring.social.kakao.url.token</span><span class="p">=</span><span class="s">https://kauth.kakao.com/oauth/token</span>
<span class="py">spring.social.kakao.url.profile</span><span class="p">=</span><span class="s">https://kapi.kakao.com/v2/user/me</span>
</code></pre></div></div>

<p><strong>Social Login ì²˜ë¦¬ Controller ì¶”ê°€</strong></p>
<ul>
  <li>Kakao Login í™”ë©´ìœ¼ë¡œ Fowording í•  ìˆ˜ ìˆëŠ” Demo í˜ì´ì§€ ì—°ë™ ì²˜ë¦¬</li>
  <li>Kakao ì—°ë™ í›„ redirect ì²˜ë¦¬</li>
</ul>

<p><strong>ë¡œê·¸ì¸ í™”ë©´</strong></p>
<ul>
  <li>/resource/templates/social/login.ftl
    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"popupKakaoLogin()"</span><span class="nt">&gt;</span>KakaoLogin<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="kd">function</span> <span class="nx">popupKakaoLogin</span><span class="p">()</span> <span class="p">{</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">${loginUrl}</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">popupKakaoLogin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">width=700,height=500,scrollbars=0,toolbar=0,menubar=no</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>    </div>
    <p><em>(ë§Œì•½ View Mapping ì•ˆëœë‹¤ë©´, Freemarker Bean ë“±ë¡!)</em></p>
  </li>
</ul>

<p><strong>User Entity ìˆ˜ì •</strong></p>
<ul>
  <li>provoider í•„ë“œ ì¶”ê°€</li>
  <li>Social Login ì€ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”ì—†ìœ¼ë¯€ë¡œ password í•„ë“œëŠ” Null í—ˆìš©ìœ¼ë¡œ ë³€ê²½</li>
</ul>

<p><strong>User JPA Repository ìˆ˜ì •</strong></p>
<ul>
  <li>Uid ì™€ Provider ë¡œ íšŒì› ì •ë³´ ì¡°íšŒí•˜ëŠ” Method ì¶”ê°€
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Optional</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;</span> <span class="nf">findByUidAndProvider</span><span class="o">(</span><span class="nc">String</span> <span class="n">uid</span><span class="o">,</span> <span class="nc">String</span> <span class="n">provider</span><span class="o">);</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Social Login ì— í•„ìš”í•œ Model ê°ì²´ ìƒì„±</strong></p>
<ul>
  <li>RetKakaoAuth.java
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RetKakaoAuth</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">access_token</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">token_type</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">refresh_token</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">long</span> <span class="n">expires_in</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">String</span> <span class="n">scope</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>KakaoProfile.java
    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ToString</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KakaoProfile</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
  <span class="kd">private</span> <span class="nc">Properties</span> <span class="n">properties</span><span class="o">;</span>

  <span class="nd">@Getter</span>
  <span class="nd">@Setter</span>
  <span class="nd">@ToString</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Properties</span> <span class="o">{</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">nickname</span><span class="o">;</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">thumbnail_image</span><span class="o">;</span>
      <span class="kd">private</span> <span class="nc">String</span> <span class="n">profile_image</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<p><strong>Kakao ì—°ë™ Service ìƒì„±</strong></p>
<ul>
  <li>Kakao Token ì¡°íšŒ method êµ¬í˜„</li>
  <li>Kakao profile ì¡°íšŒ method êµ¬í˜„</li>
</ul>

<p><strong>Social Login ì—°ë™í•  REST API ì¶”ê°€</strong></p>
<ul>
  <li>Kakao ì™€ ì—°ë™ ì—¬ë¶€ í™•ì¸í•œ í›„ JWT Token ë°œê¸‰ ì²˜ë¦¬</li>
</ul>

<p><strong>Security Config ê´€ë ¨ ì„¤ì • ìˆ˜ì •</strong></p>
<ul>
  <li>â€œ/social/**â€ API ê¶Œí•œ ìŠ¹ì¸ ì²˜ë¦¬</li>
</ul>

<hr />

<h2 id="ì¶”ê°€">ì¶”ê°€</h2>
<h4 id="social-login-test-flow">Social Login TEST Flow</h4>
<ol>
  <li>/social/login ì ‘ì†</li>
  <li>ì†Œì…œ ë¡œê·¸ì¸ ìš”ì²­</li>
  <li>ì†Œì…œ ë¡œê·¸ì¸ ì™„ë£Œ í›„ access_token ë°œê¸‰</li>
  <li>/swagger-ui.html ì ‘ì†</li>
  <li>/api/sign/signup/{provider} ì‚¬ìš©ì ê°€ì…
    <ol>
      <li>ë°œê¸‰ë°›ì€ Social Login access_token í•„ìš”</li>
    </ol>
  </li>
  <li>/api/sign/singin ì‚¬ìš©ì ë¡œê·¸ì¸í•˜ì—¬ JWT Token ë°œê¸‰</li>
  <li>ë°œê¸‰ë°›ì€ JWT Token ìœ¼ë¡œ API í…ŒìŠ¤íŠ¸</li>
</ol>

<h4 id="social-login-ê´€ë ¨-ê¸°íƒ€-class-ë°-interface2">Social Login ê´€ë ¨ ê¸°íƒ€ Class ë° Interface2</h4>
<h5 id="resttemplate-class">RestTemplate Class</h5>
<ul>
  <li>Spring ì—ì„œ ì§€ì›í•˜ëŠ” REST API ë¥¼ í˜¸ì¶œí•˜ê³  ì‘ë‹µ ë°›ì„ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ë™ê¸° ë°©ì‹ì˜ ë‚´ì¥ Class <strong><em>(ë¹„ë™ê¸°ì‹ì€ AsyncRestTemplate.class)</em></strong></li>
  <li>HTTP í”„ë¡œí† ì½œì˜ ë©”ì„œë“œë“¤ ì œê³µ</li>
</ul>

<hr />

<p><a href="https://github.com/JiYoonKimjimmy/demo-rest-api">ê´€ë ¨ Github Repository</a></p>
:ET